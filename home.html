<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Comunidad Piura - Principal (Halloween B/N)</title>
  <link rel="icon" type="image/png" href="https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcReMJly0vwqQtfircDFDpZwXu18Sd3bSMIOsRRLQyJ0irbFg3KC">
  <meta name="color-scheme" content="dark">
  <style>
    /* ===== RESET ===== */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html,body { height: 100%; }
    :root{
      --bg:#000;
      --fg:#efefef;
      --muted:#bdbdbd;
      --glass: rgba(255,255,255,0.03);
      --glass-2: rgba(255,255,255,0.025);
    }

    /* ===== BODY: Halloween elegante B/N ===== */
    body {
      font-family: "Poppins", "Segoe UI", Arial, sans-serif;
      background: var(--bg);
      color: var(--fg);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
      line-height: 1.6;
    }

    /* page wrapper to control stacking */
    .page-wrap { position: relative; z-index: 80; }

    /* ===== Visual layers (full screen, behind UI) ===== */
    #hn-fog, #hn-particles, #hn-spot, #hn-web-canvas {
      position: fixed;
      inset: 0;
      z-index: 1;
      pointer-events: none; /* NEVER block UI */
    }

    /* vignette */
    .hn-vignette {
      position: fixed;
      inset: 0;
      background: radial-gradient(ellipse at center, rgba(255,255,255,0.02) 0%, rgba(0,0,0,0.72) 60%, rgba(0,0,0,0.94) 100%);
      z-index: 2;
      pointer-events: none;
    }

    /* decorative static svg webs (corners) */
    .hn-web {
      position: fixed;
      z-index: 50;
      pointer-events: none;
      opacity: 0.95;
      filter: drop-shadow(0 8px 14px rgba(0,0,0,0.6)) grayscale(100%) contrast(120%);
    }
    .hn-web.top-left  { left: 10px; top: 10px; width: 160px; transform: rotate(-6deg); }
    .hn-web.bottom-right { right: 10px; bottom: 10px; width: 180px; transform: rotate(6deg); }
    .hn-web.top-right { right: 20px; top: 20px; width: 120px; }

    /* ===== Header & nav (kept functional) ===== */
    header, .header {
      display:flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 24px;
      position: fixed;
      top: 0;
      width: 100%;
      height: 88px;
      z-index: 90; /* above visual layers */
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.45));
      backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(255,255,255,0.04);
      transition: backdrop-filter .3s ease, background .3s ease;
    }
    header::after{ content:""; position:absolute; inset:0; pointer-events:none; mix-blend-mode:overlay; }

    header .logo, .header .logo {
      position: relative;
      z-index: 92;
      width: 96px;
      height: auto;
      filter: grayscale(100%) contrast(120%);
    }
    header nav, .header nav {
      position: relative;
      z-index: 92;
      display:flex;
      gap: 18px;
      align-items:center;
    }
    header nav a, .header nav a {
      color: var(--fg);
      text-decoration:none;
      font-weight: 600;
      letter-spacing: .2px;
      padding: 6px 8px;
      transition: color .18s ease, transform .18s;
      position: relative;
    }
    header nav a::after{
      content:"";
      position:absolute;
      left:0; bottom:-6px;
      width:0; height:2px; background: #fff;
      transition: width .22s ease, opacity .22s;
      opacity:0.06;
    }
    header nav a:hover { color: #fff; transform: translateY(-2px); }
    header nav a:hover::after{ width:100%; opacity:0.12; }

    /* profile area */
    .perfil {
      display:flex;
      align-items:center;
      gap:10px;
      cursor: pointer;
      z-index: 92;
      position:relative;
    }
    .perfil-img {
      width:42px; height:42px; border-radius:50%;
      border: 2px solid rgba(255,255,255,0.06);
      object-fit:cover;
      background:#111;
      filter: grayscale(100%) contrast(120%);
    }
    .perfil span { color:var(--fg); font-weight:700; font-size:15px; text-shadow: 0 6px 18px rgba(255,255,255,0.02); }

    .perfil-menu {
      display:none;
      position:absolute;
      right:0;
      top:62px;
      background: rgba(0,0,0,0.65);
      border:1px solid rgba(255,255,255,0.03);
      padding:10px;
      border-radius:10px;
      min-width:200px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.8);
      z-index: 200;
    }
    .perfil-menu a, .perfil-menu button { display:block; color:var(--muted); text-decoration:none; padding:6px 0; border:none; background:transparent; text-align:left; cursor:pointer; }
    .perfil-menu a:hover, .perfil-menu button:hover { color:#fff; }

    /* mobile menu button */
    .menu-toggle {
      display:none;
      z-index: 92;
      background: transparent;
      color: var(--fg);
      font-size: 28px;
      border: none;
      cursor: pointer;
      padding:8px;
    }

    /* ===== Content area (keeps structure) ===== */
    .content {
      max-width: 1100px;
      margin: 140px auto 60px; /* margin top compensates header */
      padding: 0 18px;
      position: relative;
      z-index: 92;
    }
    .content h2 {
      color: #fff;
      font-size: 32px;
      margin-bottom: 18px;
      letter-spacing: .4px;
      text-shadow: 0 10px 30px rgba(255,255,255,0.02);
    }
    #cumple-home { font-size: 20px; color: #eaeaea; }

    /* ===== Cards & Glass effects ===== */
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      padding:18px;
      border-radius:12px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.7);
      transition: transform .18s ease, box-shadow .18s ease;
    }
    .card:hover { transform: translateY(-6px); box-shadow: 0 20px 60px rgba(0,0,0,0.8); }

    /* ===== Carousel (keeps behavior) ===== */
    .carousel {
      width: 100%;
      overflow: hidden;
      margin: 36px 0;
      padding: 18px 0;
      border-top: 1px solid rgba(255,255,255,0.03);
      border-bottom: 1px solid rgba(255,255,255,0.03);
    }
    .carousel-track {
      display:flex;
      gap: 20px;
      animation: hn-scroll 28s linear infinite;
    }
    .carousel img {
      width: 200px;
      height: 200px;
      object-fit: cover;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.04);
      filter: grayscale(100%) contrast(115%);
      box-shadow: 0 10px 30px rgba(0,0,0,0.75);
      background: #080808;
    }
    @keyframes hn-scroll { from { transform: translateX(0); } to { transform: translateX(-50%); } }

    /* ===== Footer (keeps structure) ===== */
    .footer-container {
      display:flex;
      flex-wrap:wrap;
      justify-content:space-between;
      max-width:1200px;
      margin: 40px auto;
      padding: 20px;
      position: relative;
      z-index: 92;
    }
    footer h4 { color:#fff; margin-bottom:8px; }
    .footer-section a { color:#ddd; text-decoration:none; }
    .footer-section a:hover { color:#fff; }

    /* ===== Controls: music button ===== */
    .hn-controls {
      position: fixed;
      left: 18px;
      bottom: 18px;
      z-index: 300;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .hn-btn {
      background: rgba(255,255,255,0.03);
      color: var(--fg);
      border: 1px solid rgba(255,255,255,0.06);
      padding: 8px 10px;
      border-radius: 10px;
      cursor: pointer;
      backdrop-filter: blur(4px);
      transition: transform .15s ease, background .15s;
      font-weight:600;
    }
    .hn-btn:hover { transform: translateY(-3px); background: rgba(255,255,255,0.05); }

    /* ===== Modal (keeps behavior) ===== */
    .modal {
      display:none;
      position:fixed;
      inset:0;
      background: rgba(0,0,0,0.75);
      justify-content:center;
      align-items:center;
      z-index: 220;
    }
    .modal-content {
      background:#0f0f0f;
      padding:18px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.04);
      width:320px;
      color:#efefef;
    }
    .modal-content h2 { color:#fff; margin-bottom:12px; }
    .modal-buttons button { padding:8px 12px; border-radius:8px; border:none; cursor:pointer; }

    /* ===== Small responsive tweaks ===== */
    @media (max-width: 820px) {
      .menu-toggle { display:inline-flex; }
      header nav { display:none; }
      .carousel img { width:140px; height:140px; }
      .hn-web.top-left { width:120px; }
    }

    /* little glitch effect for headings (subtle) */
    .glitch {
      position: relative;
      display:inline-block;
    }
    .glitch::after, .glitch::before {
      content: attr(data-text);
      position: absolute;
      left:0; top:0;
      width:100%;
      opacity: .03;
      pointer-events: none;
      mix-blend-mode: overlay;
    }
    .glitch::before { transform: translate(-1px, -1px); }
    .glitch::after  { transform: translate(1px, 1px); }

  </style>
</head>
<body style="display:none;"> <!-- hidden until auth reveals it (kept behavior) -->

  <!-- ===== Visual Layers ===== -->
  <canvas id="hn-fog" aria-hidden="true"></canvas>
  <canvas id="hn-particles" aria-hidden="true"></canvas>
  <canvas id="hn-web-canvas" aria-hidden="true"></canvas> <!-- interactive web -->
  <canvas id="hn-spot" aria-hidden="true"></canvas>
  <div class="hn-vignette" aria-hidden="true"></div>

  <!-- decorative static spiderwebs (public domain svgs) -->
  <img src="https://upload.wikimedia.org/wikipedia/commons/2/21/Spider_web.svg" class="hn-web top-left" aria-hidden="true" alt="">
  <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Spider_web_2.svg" class="hn-web bottom-right" aria-hidden="true" alt="">
  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6c/Spider_web_3.svg" class="hn-web top-right" aria-hidden="true" alt="">

  <!-- ===== Page content (structure preserved) ===== -->
  <div class="page-wrap">
    <header class="header">
      <img src="ComunidadPiura-removebg-preview.png" class="logo" alt="Logo Comunidad Piura">

      <nav id="main-nav" aria-label="Principal">
        <a href="./sorteos.html">Sorteos</a>
        <a href="cumple.html">Cumpleaños</a>
        <a href="eventos.html">Eventos</a>
        <a href="fotos.html">Fotos</a>
      </nav>

      <div style="display:flex;align-items:center;gap:12px;">
        <button class="menu-toggle" onclick="toggleMenu()" aria-label="Abrir menú">☰</button>

        <div class="perfil" onclick="togglePerfilMenu()" aria-haspopup="true" aria-expanded="false">
          <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Perfil" class="perfil-img">
          <span id="perfil-nombre">Usuario</span>
          <div class="perfil-menu" id="perfil-menu" aria-hidden="true">
            <p id="perfil-email" style="color:#ddd;margin:0 0 8px 0;">correo@ejemplo.com</p>
            <button onclick="cambiarNombre()" style="display:block;margin-bottom:8px;">Cambiar nombre</button>
            <a href="#" onclick="logout()">Cerrar sesión</a>
          </div>
        </div>
      </div>
    </header>

    <main class="content" role="main">
      <h2 class="glitch" data-text="CUMPLEAÑOS DE LA COMUNIDAD">CUMPLEAÑOS DE LA COMUNIDAD</h2>

      <div id="cumple-home" class="center" style="margin:20px 0; font-size:20px; color:#eaeaea;">
        <!-- contenido dinámico desde Firestore -->
      </div>

      <section class="carousel" aria-label="Galería">
        <div class="carousel-track" id="carousel-track" aria-hidden="false">
          <!-- mantiene las imágenes originales (el usuario debe subir reales) -->
          <img src="imagen1.jpg" alt="Imagen 1">
          <img src="imagen2.jpg" alt="Imagen 2">
          <img src="imagen3.jpg" alt="Imagen 3">
          <img src="imagen4.jpg" alt="Imagen 4">
          <img src="imagen5.jpg" alt="Imagen 5">
          <img src="imagen6.jpg" alt="Imagen 6">
          <img src="imagen7.jpg" alt="Imagen 7">
        </div>
      </section>

      <div class="footer-container">
        <div class="footer-section legal card">
          <h4>Información legal</h4>
          <ul style="color:#ccc; margin-left: 18px;">
            <li><a href="#">Términos y condiciones</a></li>
            <li><a href="#">Políticas de privacidad</a></li>
            <li><a href="#">Política de cookies</a></li>
          </ul>
        </div>

        <div class="footer-section redes center card">
          <img class="logo" src="ComunidadPiura-removebg-preview.png" alt="Logo Comunidad Piura" style="width:120px;filter:grayscale(100%);">
          <div class="social-icons" style="margin-top:8px;">
            <img class="icono" src="la.png" alt="" style="width:20px; height:18px; filter:grayscale(100%);"> <a href="#">Instagram</a>
            <img class="icono2" src="tiktok.png" alt="" style="width:22px; height:18px; filter:grayscale(100%); margin-left:8px;"><a href="#" style="margin-left:6px;">TikTok</a>
            <br>
            <img class="icono3" src="wasa.png" alt="" style="width:21px; height:18px; filter:grayscale(100%); margin-right:6px;"><a href="#">WhatsApp</a>
          </div>
          <p style="margin-top:8px;color:#bbb;">© 2025 Todos los derechos reservados - Comunidad Piura</p>
        </div>
      </div>
    </main>
  </div>

  <!-- modal cambiar nombre (estructura igual) -->
  <div id="modalNombre" class="modal" aria-hidden="true">
    <div class="modal-content">
      <h2>Escribe tu nuevo nombre:</h2>
      <input type="text" id="nuevoNombre" placeholder="Tu nombre aquí" style="width:100%; padding:8px; border-radius:6px; margin-bottom:12px; background:#0b0b0b; color:#fff; border:1px solid rgba(255,255,255,0.04);">
      <div class="modal-buttons" style="display:flex;justify-content:space-around;">
        <button onclick="guardarNombre()" style="background:#fff;color:#000;padding:8px 12px;border-radius:8px;">Aceptar</button>
        <button onclick="cerrarModal()" style="background:#555;color:#fff;padding:8px 12px;border-radius:8px;">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- ===== Controls: music button & volume ===== -->
  <div class="hn-controls" aria-hidden="false">
    <button id="hn-music-toggle" class="hn-btn" aria-pressed="false" title="Reproducir/pausar música ambiental">🔊 Ambient</button>
    <button id="hn-music-mute" class="hn-btn" title="Silenciar/activar sonido">Mute</button>
  </div>

  <!-- ambient audio (muted by default; hosted source is placeholder - replace with yours if needed) -->
  <audio id="hn-ambient-audio" loop crossorigin="anonymous">
    <source src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_47df4a80ef.mp3?filename=dark-ambient-111787.mp3" type="audio/mpeg">
    Tu navegador no soporta audio.
  </audio>

  <!-- ===== SCRIPTS UX/RESPONSIVE/CARRUSEL DUPLICATION (kept behavior) ===== -->
  <script>
    // Carrusel infinite (mismo comportamiento)
    (function(){ 
      const track = document.getElementById("carousel-track");
      if (track) track.innerHTML += track.innerHTML;
    })();
  </script>

  <!-- menú responsive -->
  <script>
    function toggleMenu() {
      const el = document.getElementById("mobile-menu");
      if (el) {
        el.style.display = (el.style.display === "flex") ? "none" : "flex";
      } else {
        const mn = document.getElementById("main-nav");
        if (mn) mn.classList.toggle("active");
      }
    }
    function closeMenu() {
      const el = document.getElementById("mobile-menu");
      if (el) el.style.display = "none";
      const mn = document.getElementById("main-nav");
      if (mn) mn.classList.remove("active");
    }
  </script>

  <!-- ===== Firebase Auth + Firestore (EL MISMO BLOQUE, no modificado en lógica) ===== -->
  <script type="module">
    // 🔹 Importar SDK de Firebase (Auth y Firestore)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { 
      getAuth, 
      onAuthStateChanged, 
      signOut, 
      updateProfile 
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import { 
      getFirestore, 
      collection, 
      getDocs 
    } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    // 🔹 Configuración de Firebase (tus valores)
    const firebaseConfig = {
      apiKey: "AIzaSyD33P7MvrIGbNo1lRSbZBXb4hZoQ_dkjVg",
      authDomain: "comunidadpiura-fed53.firebaseapp.com",
      projectId: "comunidadpiura-fed53",
      storageBucket: "comunidadpiura-fed53.appspot.com",
      messagingSenderId: "113288016871",
      appId: "1:113288016871:web:f94f6c6490bcdbca0bc342",
      measurementId: "G-68EYEMSET9"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Verificar sesión del usuario (mismo comportamiento)
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "index.html";
      } else {
        document.body.style.display = "block"; // mostramos la página cuando el usuario existe
        document.getElementById("perfil-nombre").innerText = user.displayName || user.email?.split("@")[0] || "Anónimo";
        document.getElementById("perfil-email").innerText = user.email || "Anónimo";
      }
    });

    // Cerrar sesión
    window.logout = function () {
      signOut(auth).then(() => {
        window.location.href = "index.html";
      }).catch((error) => {
        console.error("Error al cerrar sesión:", error);
      });
    };

    // Cambiar nombre (modal)
    window.cambiarNombre = function () {
      document.getElementById("modalNombre").style.display = "flex";
    };
    window.cerrarModal = function () {
      document.getElementById("modalNombre").style.display = "none";
    };
    window.guardarNombre = async function () {
      const nuevoNombre = document.getElementById("nuevoNombre").value.trim();
      if (nuevoNombre) {
        const user = auth.currentUser;
        if (user) {
          try {
            await updateProfile(user, { displayName: nuevoNombre });
            document.getElementById("perfil-nombre").innerText = nuevoNombre;
            cerrarModal();
          } catch (error) {
            console.error("Error al actualizar nombre:", error);
            alert("Hubo un error al guardar tu nombre.");
          }
        }
      } else {
        alert("Por favor escribe un nombre válido.");
      }
    };

    // Mostrar cumpleaños de HOY desde Firestore (mismo comportamiento)
    async function mostrarCumpleHome() {
      const hoy = new Date().toISOString().slice(5, 10); // MM-DD
      const querySnapshot = await getDocs(collection(db, "cumpleanios"));

      let mensaje = "";
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const cumpleHoy = (data.cumple || "").slice(5, 10);
        if (hoy === cumpleHoy) {
          mensaje += `🎉 ¡Feliz cumpleaños <b>${data.nombre}</b>! 🎂<br>`;
        }
      });

      document.getElementById("cumple-home").innerHTML = mensaje || "📅 No hay cumpleaños por hoy.";
    }

    mostrarCumpleHome();

    // Perfil menu toggle (mismo comportamiento)
    window.togglePerfilMenu = function () {
      const menu = document.getElementById("perfil-menu");
      if (!menu) return;
      menu.style.display = (menu.style.display === "flex") ? "none" : "flex";
    };

    // cerrar menu perfil on click outside
    document.addEventListener("click", (e) => {
      const perfil = document.querySelector(".perfil");
      const menu = document.getElementById("perfil-menu");
      if (menu && menu.style.display === "flex" && !perfil.contains(e.target)) {
        menu.style.display = "none";
      }
    });

  </script>

  <!-- ===== Visual effect scripts (encapsulados to avoid collisions) ===== -->
  <script>
    // --- niebla suave en canvas ---
    (function(){
      const canvas = document.getElementById('hn-fog');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      let w = canvas.width = window.innerWidth;
      let h = canvas.height = window.innerHeight;

      const layers = [];
      for (let i=0;i<5;i++){
        layers.push({
          x: Math.random()*w,
          y: Math.random()*h,
          r: 250 + Math.random()*900,
          a: 0.02 + Math.random()*0.09,
          vx: (Math.random()-0.5)*0.04,
          vy: (Math.random()-0.5)*0.02,
          rot: Math.random()*Math.PI*2,
          vr: (Math.random()-0.5)*0.0008
        });
      }

      function drawFog(){
        ctx.clearRect(0,0,w,h);
        ctx.globalCompositeOperation = 'lighter';
        for (let i=0;i<layers.length;i++){
          const L = layers[i];
          const g = ctx.createRadialGradient(L.x, L.y, L.r*0.03, L.x, L.y, L.r);
          g.addColorStop(0, `rgba(255,255,255,${L.a*0.8})`);
          g.addColorStop(0.5, `rgba(255,255,255,${L.a*0.14})`);
          g.addColorStop(1, 'rgba(255,255,255,0)');
          ctx.fillStyle = g;
          ctx.save();
          ctx.translate(L.x, L.y);
          ctx.rotate(L.rot);
          ctx.fillRect(-L.r, -L.r, L.r*2, L.r*2);
          ctx.restore();
        }
        ctx.globalCompositeOperation = 'source-over';
      }

      function updateFog(){
        layers.forEach(L => {
          L.x += L.vx;
          L.y += L.vy;
          L.rot += L.vr;
          if (L.x < -L.r) L.x = w+L.r;
          if (L.x > w+L.r) L.x = -L.r;
          if (L.y < -L.r) L.y = h+L.r;
          if (L.y > h+L.r) L.y = -L.r;
        });
        drawFog();
        requestAnimationFrame(updateFog);
      }

      window.addEventListener('resize', ()=>{
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
      });

      updateFog();
    })();

    // --- spider-like particles & subtle web lines ---
    (function(){
      const canvas = document.getElementById('hn-particles');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      let w = canvas.width = window.innerWidth;
      let h = canvas.height = window.innerHeight;

      const pts = [];
      const N = Math.max(18, Math.round((w*h)/90000)); // density
      for (let i=0;i<N;i++){
        pts.push({
          x: Math.random()*w,
          y: Math.random()*h,
          vx: (Math.random()-0.5)*0.4,
          vy: (Math.random()-0.5)*0.2,
          r: 1 + Math.random()*1.6
        });
      }

      function update(){
        ctx.clearRect(0,0,w,h);
        // points
        for (let i=0;i<pts.length;i++){
          const p = pts[i];
          p.x += p.vx; p.y += p.vy;
          if (p.x < 0 || p.x > w) p.vx *= -1;
          if (p.y < 0 || p.y > h) p.vy *= -1;

          ctx.beginPath();
          ctx.fillStyle = 'rgba(255,255,255,0.06)';
          ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
          ctx.fill();
        }

        // lines
        for (let i=0;i<pts.length;i++){
          for (let j=i+1;j<pts.length;j++){
            const a = pts[i], b = pts[j];
            const dx = a.x-b.x, dy = a.y-b.y;
            const d2 = dx*dx + dy*dy;
            if (d2 < 24000) {
              const alpha = 0.045*(1 - d2/24000);
              ctx.beginPath();
              ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
              ctx.lineWidth = 0.8;
              ctx.moveTo(a.x,a.y);
              ctx.lineTo(b.x,b.y);
              ctx.stroke();
            }
          }
        }
        requestAnimationFrame(update);
      }

      window.addEventListener('resize', ()=>{
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
      });

      update();
    })();

    // --- interactive spiderweb (lines attached to anchor points) ---
    (function(){
      const canvas = document.getElementById('hn-web-canvas');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      let w = canvas.width = window.innerWidth;
      let h = canvas.height = window.innerHeight;

      // anchor points (random across screen)
      const anchors = [];
      const A = Math.max(20, Math.round((w*h)/160000)); // number of anchors
      for (let i=0;i<A;i++){
        anchors.push({
          x: Math.random()*w,
          y: Math.random()*h,
          tx: 0, ty: 0,
          sway: Math.random()*0.9 + 0.2,
          phase: Math.random()*Math.PI*2
        });
      }

      let mouse = {x: w/2, y: h/2, active:false};

      window.addEventListener('mousemove', (e)=>{
        mouse.x = e.clientX; mouse.y = e.clientY; mouse.active=true;
      });
      window.addEventListener('mouseleave', ()=>{ mouse.active=false; });
      window.addEventListener('touchmove', (e)=>{
        const t = e.touches[0];
        if (t){ mouse.x = t.clientX; mouse.y = t.clientY; mouse.active=true; }
      }, {passive:true});
      window.addEventListener('touchend', ()=>{ mouse.active=false; });

      function update(){
        ctx.clearRect(0,0,w,h);
        // draw radial webs from anchors
        for (let i=0;i<anchors.length;i++){
          const p = anchors[i];
          p.phase += 0.002 * p.sway;
          p.tx = p.x + Math.sin(p.phase)*12;
          p.ty = p.y + Math.cos(p.phase)*10;

          // connect to nearby anchors (sparse)
          for (let j=i+1;j<anchors.length;j++){
            const q = anchors[j];
            const dx = p.tx - q.tx, dy = p.ty - q.ty;
            const d2 = dx*dx + dy*dy;
            if (d2 < 90000) {
              const alpha = 0.03*(1 - d2/90000);
              ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
              ctx.lineWidth = 0.6;
              ctx.beginPath();
              ctx.moveTo(p.tx,p.ty);
              ctx.lineTo(q.tx,q.ty);
              ctx.stroke();
            }
          }

          // small radial threads around anchor (spiderweb spoke)
          ctx.beginPath();
          for (let s=0;s<6;s++){
            const ang = (Math.PI*2/6)*s + p.phase*0.2;
            const rx = p.tx + Math.cos(ang)*(18 + Math.sin(p.phase*1.5)*4);
            const ry = p.ty + Math.sin(ang)*(18 + Math.cos(p.phase*1.5)*4);
            ctx.moveTo(p.tx,p.ty);
            ctx.lineTo(rx,ry);
          }
          ctx.strokeStyle = 'rgba(255,255,255,0.03)';
          ctx.lineWidth = 0.7;
          ctx.stroke();
        }

        // react to mouse: pull nearby anchors slightly
        if (mouse.active){
          for (let i=0;i<anchors.length;i++){
            const a = anchors[i];
            const dx = mouse.x - a.x, dy = mouse.y - a.y;
            const d2 = dx*dx + dy*dy;
            if (d2 < 90000) {
              const dist = Math.sqrt(d2) || 0.001;
              const pull = (1 - dist/300) * 6;
              a.x += dx/dist * pull * 0.06;
              a.y += dy/dist * pull * 0.04;
            }
          }
        }

        requestAnimationFrame(update);
      }

      window.addEventListener('resize', ()=>{
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
      });

      update();
    })();

    // --- spotlight that follows cursor (very subtle) ---
    (function(){
      const canvas = document.getElementById('hn-spot');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      let w = canvas.width = window.innerWidth;
      let h = canvas.height = window.innerHeight;
      let mx = w/2, my = h/2;

      window.addEventListener('mousemove', (e)=>{
        mx = e.clientX; my = e.clientY;
      });
      window.addEventListener('touchmove', (e)=>{
        const t = e.touches[0];
        if (t) { mx = t.clientX; my = t.clientY; }
      }, {passive:true});

      function draw(){
        ctx.clearRect(0,0,w,h);
        const rad = Math.max(w,h)*0.25;
        const g = ctx.createRadialGradient(mx,my,10,mx,my,rad);
        g.addColorStop(0, 'rgba(255,255,255,0.055)');
        g.addColorStop(0.45, 'rgba(255,255,255,0.01)');
        g.addColorStop(1, 'rgba(255,255,255,0)');
        ctx.fillStyle = g;
        ctx.fillRect(0,0,w,h);
        requestAnimationFrame(draw);
      }

      window.addEventListener('resize', ()=>{
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
      });

      draw();
    })();

    // ===== Ambient music control (muted by default) =====
    (function(){
      const audio = document.getElementById('hn-ambient-audio');
      const btn = document.getElementById('hn-music-toggle');
      const muteBtn = document.getElementById('hn-music-mute');

      // start muted and paused
      audio.muted = true;
      audio.volume = 0.35; // soft
      audio.pause();

      btn.addEventListener('click', ()=>{
        if (audio.paused){
          audio.play().catch(()=>{ /* autoplay may be blocked until user interacts */ });
          audio.muted = false;
          btn.innerText = '🔊 Ambient (on)';
          btn.setAttribute('aria-pressed','true');
          muteBtn.innerText = 'Unmute';
        } else {
          audio.pause();
          btn.innerText = '🔊 Ambient';
          btn.setAttribute('aria-pressed','false');
        }
      });

      muteBtn.addEventListener('click', ()=>{
        audio.muted = !audio.muted;
        muteBtn.innerText = audio.muted ? 'Mute' : 'Unmute';
      });
    })();

    // ensure canvases resize on orientation change quickly
    window.addEventListener('orientationchange', ()=>{ setTimeout(()=>{ window.dispatchEvent(new Event('resize')); }, 200); });

  </script>

</body>
</html>
